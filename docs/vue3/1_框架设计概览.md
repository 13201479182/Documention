# 框架设计概览

## 1.权衡的艺术

### 视图层框架

- 介绍
  - 此框架处处体现着艺术,无论是代码的编写还是功能的实现
- 特点
  - 框架内部的模块并非相互独立,而是相互关联以及相互制约的
- 要点
  - 框架设计者一定要对框架的定位和方向有明确的把控,便于后续模块设计和拆分

### 权衡

#### 命令式和声明式

- 命令式
  - 介绍
    - 将自然语言用代码一对一的描述出来
  - 特点
    - 强调过程
    - 性能最优
    - 维护性差
  - 执行
    - 直接触发命令

- 声明式
  - 介绍
    - 暴漏给使用者简洁的用法,却隐藏了背后的命令式实现
  - 特点
    - 强调结果
    - 性能较差
    - 维护性优
  - 执行
    - 需要先确定影响,再间接触发相关命令

- 结论
  - 性能
    - 声明式代码👎
  - 可维护性
    - 声明式代码👍

- 权衡
  - 采用
    - 采用声明式,使用者容易上手
  - 优化
    - 在维持可维护性的前提下,尽可能少的损失性能

#### 虚拟DOM的性能

- 溯源
  - 缺乏一种机制,可以极大的优化频繁的dom操作
- 介绍
  - 存储vnode
  - 利用新旧vnode的对比可以最小粒度的确定影响以及对应的执行策略
- 权衡
  - 采用原因
    - 虚拟dom可以极大的优化更新时的dom操作,因为实际开发过程中主要是这种场景
    - [^1]基于虚拟dom的声明式实际开发性能不弱于命令式
  - 优化
    - 虚拟dom是基于树形数据对象,使用困难

#### 运行时和编译时

- 运行时
  - 介绍
    - 借助render,使用树形数据对象执行命令式语句
  - 特点
    - 使用困难(树形数据结构不友好)

- 编译时
  - 介绍
    - 借助模板编译器,将模板直接编译成命令式语句
  - 案例
    - Svelte
  - 特点
    - 灵活性差
    - 难以调试
    - 低可读性

- 编译时+运行时
  - 介绍
    - 在构建时将模板编译成树形数据对象
    - 在运行时,基于编译后的树形数据对象执行命令式语句
  - 特点
    - 使用友好
    - 可以在运行时进一步优化

- 权衡
  - 采用
    - 编译时+运行时
  - 原因
    - 编译时可以优化
    - 运行时可以二次优化

## 2.框架设计和核心要素

## 3.vue3的设计思路

[^1]: 实际程序开发过程中,最优的命令式代码是很难出现的,必然存在无效或者重复的dom操作,而基于框架的声明式实现却不会。
